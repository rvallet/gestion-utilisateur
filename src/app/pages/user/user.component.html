<h2 class="section-title">Informations Personnelles</h2>

<div class="section-content" *ngIf="user" @slideFadeAnimation>
  <!-- Infos personnelles -->
  <mat-card class="info-card">
    <mat-card-content>
      <div class="info-fields">
        <mat-form-field appearance="outline">
          <mat-label>Nom</mat-label>
          <input matInput [(ngModel)]="user.nom" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Prénom</mat-label>
          <input matInput [(ngModel)]="user.prenom" />
        </mat-form-field>
      </div>
      <div class="buttons-group">
        <button mat-raised-button color="primary" (click)="updateUser()">Mettre à jour</button>
        <button mat-raised-button color="warn" (click)="deleteUser()">Supprimer mon compte</button>
        <button mat-raised-button (click)="logout()">Déconnexion</button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Bloc changement mot de passe -->
  <h2 class="section-title">Changer le mot de passe</h2>
  <mat-card class="password-card" [@fadeIn]>
    <mat-card-content>
      <form #passwordForm="ngForm" (ngSubmit)="changePassword()">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nouveau mot de passe</mat-label>
          <input matInput type="password" [(ngModel)]="newPassword" name="newPassword" required />
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmer</mat-label>
          <input matInput type="password" [(ngModel)]="confirmPassword" name="confirmPassword" required />
        </mat-form-field>
        <button mat-raised-button color="accent" type="submit">Changer le mot de passe</button>
      </form>
      <!-- Message d'erreur personnalisé -->
      <app-message *ngIf="passwordError" [message]="passwordError" [isError]="true"></app-message>
      <app-message *ngIf="passwordSuccess" [message]="passwordSuccess" [isError]="false"></app-message>
    </mat-card-content>
  </mat-card>

  <!-- Bloc Adresses -->
  <h2 class="section-title">Adresses</h2>
  <mat-card class="addresses-card" @slideFadeAnimation>
    <mat-card-header>
      <mat-card-title>Gestion des adresses</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngFor="let address of user.adresses; let i = index" class="address-item" [class.principale]="address.principale" @fadeIn>

        <div class="address-header">
          <mat-checkbox [(ngModel)]="address.principale" (change)="setDefaultAddress(i)">
            Adresse principale
          </mat-checkbox>
          <button mat-icon-button color="warn" (click)="removeAddress(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <div class="address-details">
          <mat-form-field appearance="outline"><mat-label>Numéro</mat-label>
            <input matInput [(ngModel)]="address.numero" (ngModelChange)="updateUser()" />
          </mat-form-field>
          <mat-form-field appearance="outline"><mat-label>Rue</mat-label>
            <input matInput [(ngModel)]="address.rue" (ngModelChange)="updateUser()" />
          </mat-form-field>
          <mat-form-field appearance="outline"><mat-label>Code Postal</mat-label>
            <input matInput [(ngModel)]="address.codePostal" (ngModelChange)="updateUser()" />
          </mat-form-field>
          <mat-form-field appearance="outline"><mat-label>Ville</mat-label>
            <input matInput [(ngModel)]="address.ville" (ngModelChange)="updateUser()" />
          </mat-form-field>
          <mat-form-field appearance="outline"><mat-label>Pays</mat-label>
            <input matInput [(ngModel)]="address.pays" (ngModelChange)="updateUser()" />
          </mat-form-field>
        </div>
      </div>
      <button mat-flat-button color="primary" (click)="addAddress()">
        <mat-icon>add</mat-icon> Ajouter une adresse
      </button>
    </mat-card-content>
  </mat-card>
</div>

<!-- Message -->
<p *ngIf="message">{{ message }}</p>
